# クラウドインフラ設計書

## ドキュメント情報
| 項目 | 内容 |
|------|------|
| ドキュメントID | BD008 |
| バージョン | 1.0 |
| 作成日 | YYYY-MM-DD |
| 作成者 | {作成者名} |
| 承認者 | {承認者名} |
| 承認日 | YYYY-MM-DD |

## 変更履歴
| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|---------|
| 1.0 | YYYY-MM-DD | {名前} | 初版作成 |

---

## 1. 設計概要

### 1.1 本書の目的
本書はクラウドインフラストラクチャの設計方針と構成を定義する。

### 1.2 対象クラウドプラットフォーム
| 項目 | 内容 |
|------|------|
| プライマリ | AWS / GCP / Azure |
| リージョン | {リージョン} |
| マルチリージョン | 有 / 無 |

### 1.3 参考資料（調査時点の最新ベストプラクティス）
| 調査日 | 情報源 | 概要 |
|--------|--------|------|
| YYYY-MM-DD | {URL/ドキュメント名} | {要点} |

> ⚠️ 技術トレンドは変化するため、設計時に最新情報を再調査すること

---

## 2. アーキテクチャ概要

### 2.1 システム構成図

```
[ここにアーキテクチャ図を記載]
```

### 2.2 設計方針

> ⚠️ ユーザーと協議の上、決定してください

【協議ポイント】
- 可用性要件（99.9%? 99.99%?）
- スケーリング要件（垂直 / 水平 / 自動）
- コスト制約
- コンプライアンス要件

### 2.3 決定事項
| 項目 | 決定内容 | 理由 | 承認者 | 日付 |
|------|---------|------|--------|------|
| アーキテクチャパターン | {記入} | {記入} | {記入} | {記入} |

---

## 3. ネットワーク設計

### 3.1 概念
VPCはクラウド上の論理的なネットワーク境界を定義し、
セキュリティとネットワーク制御の基盤となる。

### 3.2 選択肢
| パターン | 特徴 | 向いてるケース |
|---------|------|---------------|
| シングルVPC | シンプル | 小規模、単一環境 |
| マルチVPC | 環境分離 | dev/stg/prod分離 |
| Transit Gateway | 複数VPC接続 | 大規模、複数システム |

### 3.3 VPC設計

| 項目 | 設計値 | 備考 |
|------|--------|------|
| VPC CIDR | {例: 10.0.0.0/16} | |
| Availability Zone | {例: 2 AZ} | |
| Public Subnet | {CIDR} | ALB, NAT Gateway |
| Private Subnet | {CIDR} | アプリケーション |
| Isolated Subnet | {CIDR} | データベース |

### 3.4 サブネット構成図

```
VPC (10.0.0.0/16)
├── AZ-a
│   ├── Public Subnet  (10.0.1.0/24)
│   ├── Private Subnet (10.0.10.0/24)
│   └── Isolated Subnet (10.0.20.0/24)
└── AZ-c
    ├── Public Subnet  (10.0.2.0/24)
    ├── Private Subnet (10.0.11.0/24)
    └── Isolated Subnet (10.0.21.0/24)
```

### 3.5 セキュリティグループ設計

| SG名 | 用途 | インバウンド | アウトバウンド |
|------|------|-------------|---------------|
| sg-alb | ALB用 | 443 from 0.0.0.0/0 | All to sg-app |
| sg-app | アプリ用 | 8080 from sg-alb | 5432 to sg-db |
| sg-db | DB用 | 5432 from sg-app | - |

---

## 4. コンピューティング設計

### 4.1 概念
ワークロードの特性に応じて最適なコンピューティングリソースを選択する。

### 4.2 選択肢
| サービス | 特徴 | 向いてるケース |
|---------|------|---------------|
| EC2 | フル制御 | 特殊要件、リフト&シフト |
| ECS (Fargate) | コンテナ、サーバーレス | マイクロサービス |
| EKS | Kubernetes | 大規模コンテナ、マルチクラウド |
| Lambda | イベント駆動 | 非同期処理、API |

### 4.3 本プロジェクトでの採用方針

> ⚠️ ユーザーと協議の上、決定してください

【協議ポイント】
- 既存スキルセット（コンテナ経験は？）
- ワークロードの特性（常時稼働 / イベント駆動）
- 運用体制（マネージド希望？）

### 4.4 決定事項
| 項目 | 決定内容 | 理由 | 承認者 | 日付 |
|------|---------|------|--------|------|
| コンピューティング | {記入} | {記入} | {記入} | {記入} |

### 4.5 スペック設計

| コンポーネント | サービス | スペック | 台数 | Auto Scaling |
|---------------|---------|---------|------|--------------|
| Webサーバー | {ECS/EC2/...} | {スペック} | {台数} | 有/無 |
| APIサーバー | {ECS/EC2/...} | {スペック} | {台数} | 有/無 |
| バッチ | {Lambda/ECS/...} | {スペック} | - | - |

---

## 5. データベース設計

### 5.1 選択肢
| サービス | 特徴 | 向いてるケース |
|---------|------|---------------|
| RDS | マネージドRDB | OLTP、トランザクション |
| Aurora | 高性能RDB | 大規模、高可用性 |
| DynamoDB | NoSQL | 高スループット、柔軟スキーマ |
| ElastiCache | インメモリ | キャッシュ、セッション |

### 5.2 RDS/Aurora設計

| 項目 | 設計値 |
|------|--------|
| エンジン | PostgreSQL / MySQL / ... |
| バージョン | {バージョン} |
| インスタンスクラス | {例: db.r6g.large} |
| Multi-AZ | 有 / 無 |
| リードレプリカ | {台数} |
| ストレージ | {GB} / 自動拡張 |
| バックアップ保持期間 | {日数} |
| 暗号化 | 有 / 無 |

---

## 6. ストレージ設計

### 6.1 S3設計

| バケット名 | 用途 | ストレージクラス | ライフサイクル | 暗号化 |
|-----------|------|----------------|---------------|--------|
| {バケット名} | 静的コンテンツ | Standard | - | SSE-S3 |
| {バケット名} | ログ | Standard-IA → Glacier | 90日でIA、1年でGlacier | SSE-S3 |
| {バケット名} | バックアップ | Glacier | - | SSE-KMS |

### 6.2 バージョニング・レプリケーション

| バケット | バージョニング | クロスリージョンレプリケーション |
|---------|---------------|-------------------------------|
| {バケット名} | 有効 | 有 / 無 |

---

## 7. セキュリティ設計

### 7.1 IAM設計

**原則**
- 最小権限の原則
- ロールベースアクセス制御
- MFA必須（人間ユーザー）

| ロール/ポリシー | 用途 | 権限概要 |
|----------------|------|---------|
| {ロール名} | {用途} | {権限} |

### 7.2 暗号化設計

| 対象 | 暗号化方式 | 鍵管理 |
|------|-----------|--------|
| EBS | AES-256 | KMS |
| S3 | SSE-S3 / SSE-KMS | KMS |
| RDS | AES-256 | KMS |
| 通信 | TLS 1.3 | ACM |

### 7.3 WAF/Shield設計

| 項目 | 設計値 |
|------|--------|
| WAF | 有効 / 無効 |
| マネージドルール | {ルール名} |
| Shield | Standard / Advanced |

---

## 8. 監視・ログ設計

### 8.1 CloudWatch設計

| メトリクス | 対象 | 閾値 | アラームアクション |
|-----------|------|------|-------------------|
| CPUUtilization | EC2/ECS | 80%以上 | SNS通知 |
| DatabaseConnections | RDS | {閾値} | SNS通知 |
| 5XXError | ALB | 1%以上 | SNS通知 |

### 8.2 ログ設計

| ログ種別 | 出力先 | 保持期間 |
|---------|--------|---------|
| アプリケーションログ | CloudWatch Logs | {日数} |
| ALBアクセスログ | S3 | {日数} |
| CloudTrail | S3 | {日数} |
| VPCフローログ | CloudWatch Logs | {日数} |

---

## 9. コスト設計

### 9.1 概算コスト

| サービス | 月額概算 | 備考 |
|---------|---------|------|
| EC2/ECS | ${金額} | |
| RDS | ${金額} | |
| S3 | ${金額} | |
| データ転送 | ${金額} | |
| **合計** | **${金額}** | |

### 9.2 コスト最適化方針

- [ ] リザーブドインスタンス / Savings Plans 検討
- [ ] スポットインスタンス活用（適切なワークロード）
- [ ] 不要リソースの自動停止（開発環境）

---

## 10. 災害対策（DR）設計

### 10.1 DR方針

| 項目 | 設計値 |
|------|--------|
| RTO（目標復旧時間） | {時間} |
| RPO（目標復旧地点） | {時間} |
| DR戦略 | Backup & Restore / Pilot Light / Warm Standby / Multi-Site |

### 10.2 バックアップ設計

| 対象 | 方式 | 頻度 | 保持期間 | リージョン |
|------|------|------|---------|-----------|
| RDS | 自動スナップショット | 日次 | {日数} | 同一/別リージョン |
| S3 | クロスリージョンレプリケーション | リアルタイム | - | {リージョン} |
| EBS | スナップショット | 日次 | {日数} | 同一リージョン |

---

## 11. 承認

| 役割 | 氏名 | 署名 | 日付 |
|------|------|------|------|
| インフラリード | | | |
| セキュリティ担当 | | | |
| PM | | | |
