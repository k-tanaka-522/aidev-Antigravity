# 帳票設計書

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメントID | BD004 |
| ドキュメント名 | 帳票設計書 |
| システム名 | {システム名} |
| サブシステム名 | {サブシステム名} |
| 版数 | {版数} |
| ステータス | {作成中/レビュー中/承認済み} |
| 作成日 | {YYYY/MM/DD} |
| 作成者 | {作成者名} |
| 承認日 | {YYYY/MM/DD} |
| 承認者 | {承認者名} |

## 変更履歴

| 版数 | 変更日 | 変更者 | 変更内容 | 承認者 |
|------|--------|--------|----------|--------|
| 1.0 | {YYYY/MM/DD} | {変更者名} | 新規作成 | {承認者名} |
| {版数} | {YYYY/MM/DD} | {変更者名} | {変更内容} | {承認者名} |

## 目次

1. [概要](#概要)
2. [帳票一覧](#帳票一覧)
3. [帳票詳細設計](#帳票詳細設計)
4. [帳票共通仕様](#帳票共通仕様)

---

## 概要

### 目的

{この帳票設計書の目的を記述}

### 適用範囲

{この帳票設計書が適用される範囲を記述}

### 帳票種別

| 帳票種別 | 説明 | 出力形式 |
|----------|------|----------|
| 明細帳票 | データの一覧を出力する帳票 | PDF/Excel/CSV |
| 単票帳票 | 1件のデータを詳細に出力する帳票 | PDF/Excel |
| 集計帳票 | データを集計して出力する帳票 | PDF/Excel/CSV |
| ラベル帳票 | ラベル形式で出力する帳票 | PDF |
| 証憑帳票 | 請求書、納品書などの証憑類 | PDF |

---

## 帳票一覧

### 帳票一覧表

| 帳票ID | 帳票名 | 帳票種別 | 出力形式 | 用紙サイズ | 関連機能ID | 優先度 | 備考 |
|--------|--------|----------|----------|------------|------------|--------|------|
| {RPT-XXX} | {帳票名} | {帳票種別} | {PDF/Excel/CSV} | {A4/A3/B5} | {F-XX-YY} | {高/中/低} | {備考} |
| RPT-001 | 売上明細表 | 明細帳票 | PDF/Excel/CSV | A4 | F-04-01-01 | 高 | 日次・月次出力 |
| RPT-002 | 請求書 | 証憑帳票 | PDF | A4 | F-04-01-02 | 高 | 顧客別出力 |
| RPT-003 | 納品書 | 証憑帳票 | PDF | A4 | F-04-01-03 | 高 | 注文別出力 |
| RPT-004 | 在庫一覧表 | 明細帳票 | PDF/Excel/CSV | A4 | F-04-02-01 | 中 | 日次出力 |
| RPT-005 | 商品ラベル | ラベル帳票 | PDF | A4（24面） | F-04-02-02 | 中 | 商品別出力 |
| RPT-006 | 月次売上集計表 | 集計帳票 | PDF/Excel | A4 | F-04-03-01 | 高 | 月次出力 |
| RPT-007 | 顧客別売上ランキング | 集計帳票 | PDF/Excel | A4 | F-04-03-02 | 中 | 月次出力 |

---

## 帳票詳細設計

### 帳票設計テンプレート

各帳票について以下の形式で詳細を記述します。

---

#### 帳票ID: {RPT-XXX}

##### 基本情報

| 項目 | 内容 |
|------|------|
| 帳票ID | {RPT-XXX} |
| 帳票名 | {帳票名} |
| 帳票種別 | {明細/単票/集計/ラベル/証憑} |
| 出力形式 | {PDF/Excel/CSV} |
| 用紙サイズ | {A4/A3/B5} |
| 用紙向き | {縦/横} |
| 関連機能ID | {F-XX-YY-ZZ} |
| 出力トリガー | {ボタン押下/バッチ処理/API呼び出し} |
| 出力タイミング | {即時/スケジュール実行} |
| 保存期間 | {期間} |

##### 出力条件

| 条件項目 | 必須 | データ型 | デフォルト値 | 説明 |
|----------|------|----------|--------------|------|
| {条件項目名} | {○/×} | {型} | {デフォルト値} | {説明} |

##### レイアウト

```
[ここに帳票のレイアウトをASCIIアートまたは図で記述]
```

##### 出力項目一覧

| 項目No | 項目名 | 物理名 | データ型 | 桁数 | 形式 | データソース | 編集ルール | 備考 |
|--------|--------|--------|----------|------|------|--------------|------------|------|
| {No} | {項目名} | {physical_name} | {型} | {桁数} | {形式} | {テーブル.カラム} | {編集ルール} | {備考} |

##### ソートキー

| 優先順位 | 項目名 | ソート順 |
|----------|--------|----------|
| 1 | {項目名} | {昇順/降順} |
| 2 | {項目名} | {昇順/降順} |

##### 集計項目（集計帳票の場合）

| 集計項目 | 集計方法 | 集計単位 |
|----------|----------|----------|
| {項目名} | {SUM/AVG/COUNT/MAX/MIN} | {全体/グループ別} |

---

### RPT-001: 売上明細表

##### 基本情報

| 項目 | 内容 |
|------|------|
| 帳票ID | RPT-001 |
| 帳票名 | 売上明細表 |
| 帳票種別 | 明細帳票 |
| 出力形式 | PDF/Excel/CSV |
| 用紙サイズ | A4 |
| 用紙向き | 横 |
| 関連機能ID | F-04-01-01 |
| 出力トリガー | 画面からのボタン押下、バッチ処理 |
| 出力タイミング | 即時出力、日次バッチ（毎日2:00） |
| 保存期間 | 7年間 |

##### 出力条件

| 条件項目 | 必須 | データ型 | デフォルト値 | 説明 |
|----------|------|----------|--------------|------|
| 集計期間（開始日） | ○ | Date | 当月1日 | 集計対象の開始日 |
| 集計期間（終了日） | ○ | Date | 当月末日 | 集計対象の終了日 |
| 顧客ID | × | String | 全顧客 | 特定顧客に絞り込む場合に指定 |
| 商品カテゴリ | × | String | 全カテゴリ | 特定カテゴリに絞り込む場合に指定 |
| 出力形式 | ○ | String | PDF | PDF/Excel/CSVから選択 |

##### レイアウト（PDF形式）

```
┌───────────────────────────────────────────────────────────────┐
│                          売上明細表                           │
│                                                               │
│ 出力日時: 2024/01/15 10:30:45            ページ: 1 / 5       │
│ 集計期間: 2024/01/01 ~ 2024/01/31                             │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│ ┌─┬──────┬────────┬──────┬─────┬─────┬────────┐ │
│ │No│売上日  │顧客名      │商品名  │数量  │単価  │売上金額  │ │
│ ├─┼──────┼────────┼──────┼─────┼─────┼────────┤ │
│ │ 1│01/05  │株式会社A   │商品X   │   10│ 1,000│   10,000│ │
│ │ 2│01/05  │株式会社B   │商品Y   │    5│ 2,000│   10,000│ │
│ │ 3│01/06  │株式会社A   │商品Z   │    3│ 3,000│    9,000│ │
│ │ ...                                                        │ │
│ │100│01/31  │株式会社C   │商品X   │   20│ 1,000│   20,000│ │
│ └─┴──────┴────────┴──────┴─────┴─────┴────────┘ │
│                                                               │
│ 合計件数: 100件                    合計売上金額: 1,234,567円  │
├───────────────────────────────────────────────────────────────┤
│ {会社名}                                                      │
└───────────────────────────────────────────────────────────────┘
```

##### 出力項目一覧

| 項目No | 項目名 | 物理名 | データ型 | 桁数 | 形式 | データソース | 編集ルール | 備考 |
|--------|--------|--------|----------|------|------|--------------|------------|------|
| 1 | No | row_number | Integer | - | - | - | 連番 | 1から採番 |
| 2 | 売上日 | sales_date | Date | - | MM/DD | sales.sales_date | 月/日形式 | |
| 3 | 顧客名 | customer_name | String | 50 | - | customers.customer_name | - | |
| 4 | 商品名 | product_name | String | 100 | - | products.product_name | 30文字で切り捨て | 長い場合は... |
| 5 | 数量 | quantity | Integer | 10 | 右寄せ | sales_details.quantity | カンマ区切り | |
| 6 | 単価 | unit_price | Decimal | 10,2 | 右寄せ | sales_details.unit_price | カンマ区切り | |
| 7 | 売上金額 | amount | Decimal | 12,2 | 右寄せ | sales_details.amount | カンマ区切り | 数量×単価 |

##### ソートキー

| 優先順位 | 項目名 | ソート順 |
|----------|--------|----------|
| 1 | 売上日 | 昇順 |
| 2 | 顧客名 | 昇順 |
| 3 | 商品名 | 昇順 |

##### ヘッダー・フッター

| 区分 | 配置 | 項目 | 内容 |
|------|------|------|------|
| ヘッダー | 中央 | 帳票タイトル | 売上明細表 |
| ヘッダー | 左上 | 出力日時 | 出力日時: YYYY/MM/DD HH:mm:ss |
| ヘッダー | 右上 | ページ番号 | ページ: {現在ページ} / {総ページ数} |
| ヘッダー | 左下 | 集計期間 | 集計期間: YYYY/MM/DD ~ YYYY/MM/DD |
| フッター | 左下 | 会社名 | {会社名} |
| フッター | 右下 | 合計 | 合計件数: {件数}件、合計売上金額: {金額}円 |

---

### RPT-002: 請求書

##### 基本情報

| 項目 | 内容 |
|------|------|
| 帳票ID | RPT-002 |
| 帳票名 | 請求書 |
| 帳票種別 | 証憑帳票 |
| 出力形式 | PDF |
| 用紙サイズ | A4 |
| 用紙向き | 縦 |
| 関連機能ID | F-04-01-02 |
| 出力トリガー | 画面からのボタン押下 |
| 出力タイミング | 即時出力 |
| 保存期間 | 7年間（電子帳簿保存法対応） |

##### 出力条件

| 条件項目 | 必須 | データ型 | デフォルト値 | 説明 |
|----------|------|----------|--------------|------|
| 請求書ID | ○ | String | - | 出力対象の請求書ID |

##### レイアウト（PDF形式）

```
┌───────────────────────────────────────────────────────────────┐
│                                               請求書No: 2024010001 │
│                                               発行日: 2024/01/31   │
│                                                                    │
│ {顧客名} 御中                                                      │
│ 〒{郵便番号}                                                       │
│ {住所}                                                             │
│                                                                    │
│ 下記の通りご請求申し上げます。                                     │
│                                                                    │
│ ご請求金額: ¥1,234,567（税込）                                     │
│                                                                    │
│ お支払期限: 2024/02/29                                             │
│ お支払方法: 銀行振込                                               │
│                                                                    │
├────────────────────────────────────────────────────────────┤
│ ┌──┬────────────────┬────┬────┬──────┐         │
│ │No │品名                 │数量 │単価 │金額     │         │
│ ├──┼────────────────┼────┼────┼──────┤         │
│ │ 1 │商品A                │  10 │1,000│  10,000 │         │
│ │ 2 │商品B                │   5 │2,000│  10,000 │         │
│ │ 3 │商品C                │   3 │3,000│   9,000 │         │
│ │   │                     │     │     │         │         │
│ │   │                     │     │     │         │         │
│ └──┴────────────────┴────┴────┴──────┘         │
│                                                                    │
│                               小計:         29,000円              │
│                               消費税(10%):   2,900円              │
│                               合計:         31,900円              │
├────────────────────────────────────────────────────────────┤
│ 【振込先】                                                         │
│ 銀行名: {銀行名}                                                   │
│ 支店名: {支店名}                                                   │
│ 口座種別: {普通/当座}                                              │
│ 口座番号: {口座番号}                                               │
│ 口座名義: {口座名義}                                               │
│                                                                    │
│ 【発行元】                                                         │
│ {会社名}                                                           │
│ 〒{郵便番号}                                                       │
│ {住所}                                                             │
│ TEL: {電話番号}  FAX: {FAX番号}                                    │
│ 担当者: {担当者名}                                                 │
└────────────────────────────────────────────────────────────┘
```

##### 出力項目一覧

| 項目No | 項目名 | 物理名 | データ型 | 桁数 | 形式 | データソース | 編集ルール | 備考 |
|--------|--------|--------|----------|------|------|--------------|------------|------|
| 1 | 請求書No | invoice_number | String | 20 | - | invoices.invoice_number | - | |
| 2 | 発行日 | issue_date | Date | - | YYYY/MM/DD | invoices.issue_date | - | |
| 3 | 顧客名 | customer_name | String | 100 | - | customers.customer_name | - | |
| 4 | 郵便番号 | postal_code | String | 8 | XXX-XXXX | customers.postal_code | ハイフン挿入 | |
| 5 | 住所 | address | String | 200 | - | customers.address | - | |
| 6 | ご請求金額 | total_amount_with_tax | Decimal | 12,2 | カンマ区切り | invoices.total_amount_with_tax | - | |
| 7 | お支払期限 | due_date | Date | - | YYYY/MM/DD | invoices.due_date | - | |
| 8 | お支払方法 | payment_method | String | 50 | - | invoices.payment_method | - | |
| 9 | 明細No | line_number | Integer | - | - | - | 連番 | |
| 10 | 品名 | product_name | String | 100 | - | invoice_details.product_name | - | |
| 11 | 数量 | quantity | Integer | 10 | 右寄せ | invoice_details.quantity | カンマ区切り | |
| 12 | 単価 | unit_price | Decimal | 10,2 | 右寄せ | invoice_details.unit_price | カンマ区切り | |
| 13 | 金額 | amount | Decimal | 12,2 | 右寄せ | invoice_details.amount | カンマ区切り | |
| 14 | 小計 | subtotal | Decimal | 12,2 | カンマ区切り | invoices.subtotal | - | |
| 15 | 消費税 | tax | Decimal | 12,2 | カンマ区切り | invoices.tax | (10%) 表示 | |
| 16 | 合計 | total | Decimal | 12,2 | カンマ区切り | invoices.total_amount_with_tax | - | |

---

### RPT-006: 月次売上集計表

##### 基本情報

| 項目 | 内容 |
|------|------|
| 帳票ID | RPT-006 |
| 帳票名 | 月次売上集計表 |
| 帳票種別 | 集計帳票 |
| 出力形式 | PDF/Excel |
| 用紙サイズ | A4 |
| 用紙向き | 横 |
| 関連機能ID | F-04-03-01 |
| 出力トリガー | バッチ処理 |
| 出力タイミング | 月次バッチ（毎月1日 3:00） |
| 保存期間 | 10年間 |

##### 出力条件

| 条件項目 | 必須 | データ型 | デフォルト値 | 説明 |
|----------|------|----------|--------------|------|
| 集計年月 | ○ | String | 前月 | YYYY/MM形式 |
| 出力形式 | ○ | String | PDF | PDF/Excelから選択 |

##### レイアウト（PDF形式）

```
┌───────────────────────────────────────────────────────────────┐
│                      月次売上集計表                            │
│                                                                │
│ 対象年月: 2024年1月                   出力日: 2024/02/01       │
├────────────────────────────────────────────────────────────┤
│                                                                │
│ ┌────────┬────┬────┬────────┬──────┬──────┐   │
│ │カテゴリ  │件数 │数量 │売上金額   │前月比   │前年比   │   │
│ ├────────┼────┼────┼────────┼──────┼──────┤   │
│ │電化製品  │  150│  300│ 1,500,000│ +10.5% │  +5.2% │   │
│ │家具      │   80│  120│   800,000│  -5.3% │ +12.1% │   │
│ │日用品    │  200│  500│   300,000│  +2.1% │  -3.5% │   │
│ │...                                                     │   │
│ └────────┴────┴────┴────────┴──────┴──────┘   │
│                                                                │
│ 合計:     件数 430件  数量 920個  売上金額 2,600,000円         │
│                                                                │
│ 【前月比較】                                                   │
│ 売上金額: +150,000円 (+6.1%)                                   │
│ 件数: +20件 (+4.9%)                                            │
│                                                                │
│ 【前年同月比較】                                               │
│ 売上金額: +200,000円 (+8.3%)                                   │
│ 件数: +30件 (+7.5%)                                            │
└────────────────────────────────────────────────────────────┘
```

##### 出力項目一覧

| 項目No | 項目名 | 物理名 | データ型 | 桁数 | 形式 | データソース | 編集ルール | 備考 |
|--------|--------|--------|----------|------|------|--------------|------------|------|
| 1 | カテゴリ | category_name | String | 50 | - | categories.category_name | - | |
| 2 | 件数 | sales_count | Integer | 10 | 右寄せ | - | カンマ区切り | 集計値 |
| 3 | 数量 | total_quantity | Integer | 10 | 右寄せ | - | カンマ区切り | 集計値 |
| 4 | 売上金額 | total_amount | Decimal | 12,2 | 右寄せ | - | カンマ区切り | 集計値 |
| 5 | 前月比 | mom_ratio | Decimal | 6,1 | 右寄せ | - | %表示、+/-符号付き | 計算値 |
| 6 | 前年比 | yoy_ratio | Decimal | 6,1 | 右寄せ | - | %表示、+/-符号付き | 計算値 |

##### 集計項目

| 集計項目 | 集計方法 | 集計単位 |
|----------|----------|----------|
| 件数 | COUNT | カテゴリ別 |
| 数量 | SUM | カテゴリ別 |
| 売上金額 | SUM | カテゴリ別 |

---

## 帳票共通仕様

### 出力形式別仕様

#### PDF形式

| 項目 | 仕様 |
|------|------|
| フォント | 日本語: {MS明朝/游明朝/Noto Serif JP}, 英数字: {Times New Roman/Arial} |
| フォントサイズ | タイトル: 16pt, 見出し: 12pt, 本文: 10pt |
| 余白 | 上下左右: 20mm |
| ヘッダー高さ | 15mm |
| フッター高さ | 10mm |
| 暗号化 | AES-256（パスワード保護オプション） |
| 透かし | 「{会社名} 社外秘」（オプション） |

#### Excel形式

| 項目 | 仕様 |
|------|------|
| ファイル形式 | .xlsx（Office Open XML） |
| シート名 | 帳票名 |
| フォント | 日本語: {MS Pゴシック/游ゴシック}, 英数字: {Arial} |
| フォントサイズ | タイトル: 14pt, 見出し: 11pt, 本文: 10pt |
| 罫線 | すべてのセルに罫線 |
| ヘッダー行 | 固定表示、フィルター有効 |
| 印刷設定 | A4サイズ、自動改ページ |

#### CSV形式

| 項目 | 仕様 |
|------|------|
| 文字コード | UTF-8 with BOM |
| 区切り文字 | カンマ（,） |
| 囲み文字 | ダブルクォーテーション（"） |
| 改行コード | CRLF（\r\n） |
| ヘッダー行 | 項目名を1行目に出力 |
| 日付形式 | YYYY-MM-DD |
| 数値形式 | カンマなし、小数点は. |

### パフォーマンス要件

| 項目 | 要件 |
|------|------|
| 出力時間 | 1万件以下: 30秒以内、10万件以下: 5分以内 |
| 最大出力件数 | PDF: 10万件、Excel: 100万件、CSV: 無制限 |
| 同時出力数 | 10帳票まで同時出力可能 |
| タイムアウト | 10分 |

### セキュリティ要件

| 項目 | 要件 |
|------|------|
| アクセス制御 | 権限に応じた出力制限 |
| ダウンロード制限 | IPアドレス制限（オプション） |
| 透かし | 社外秘帳票には透かし挿入 |
| パスワード保護 | 重要帳票はパスワード必須 |
| ダウンロードログ | 全ダウンロードをログ記録 |

### エラー処理

| エラー種別 | エラーメッセージ | 対処方法 |
|------------|------------------|----------|
| データなし | 出力対象のデータがありません | 条件を変更して再実行 |
| タイムアウト | 出力処理がタイムアウトしました | 期間を短くして再実行 |
| 件数超過 | 出力可能な最大件数を超えています | 条件を絞り込んで再実行 |
| システムエラー | システムエラーが発生しました | 管理者に連絡 |

---

## 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 作成者 | {作成者名} | {YYYY/MM/DD} | |
| レビュー担当者 | {レビュー担当者名} | {YYYY/MM/DD} | |
| 承認者 | {承認者名} | {YYYY/MM/DD} | |

---

## 参照

### 関連ドキュメント

- [機能設計書] BD002_機能設計書
- [バッチ設計書] BD007_バッチ設計書
- [データベース設計書] BD006-XX_データベース設計書

### 外部参照

- {参照先タイトル}: {URL}
