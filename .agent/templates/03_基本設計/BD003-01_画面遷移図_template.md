# 画面遷移図

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメントID | BD003-01 |
| ドキュメント名 | 画面遷移図 |
| システム名 | {システム名} |
| サブシステム名 | {サブシステム名} |
| 版数 | {版数} |
| ステータス | {作成中/レビュー中/承認済み} |
| 作成日 | {YYYY/MM/DD} |
| 作成者 | {作成者名} |
| 承認日 | {YYYY/MM/DD} |
| 承認者 | {承認者名} |

## 変更履歴

| 版数 | 変更日 | 変更者 | 変更内容 | 承認者 |
|------|--------|--------|----------|--------|
| 1.0 | {YYYY/MM/DD} | {変更者名} | 新規作成 | {承認者名} |
| {版数} | {YYYY/MM/DD} | {変更者名} | {変更内容} | {承認者名} |

## 目次

1. [概要](#概要)
2. [画面一覧](#画面一覧)
3. [全体画面遷移図](#全体画面遷移図)
4. [機能別画面遷移図](#機能別画面遷移図)
5. [画面遷移仕様](#画面遷移仕様)

---

## 概要

### 目的

{この画面遷移図の目的を記述}

### 適用範囲

{この画面遷移図が適用される範囲を記述}

### 画面種別

| 画面種別 | 説明 | 備考 |
|----------|------|------|
| 一覧画面 | データの一覧表示画面 | 検索・ソート・ページング機能を含む |
| 詳細画面 | データの詳細表示画面 | 1件のデータを詳細に表示 |
| 登録画面 | データの新規登録画面 | 入力フォーム形式 |
| 編集画面 | データの編集画面 | 既存データの更新 |
| 確認画面 | 入力内容の確認画面 | 登録/更新前の確認 |
| 完了画面 | 処理完了画面 | 処理完了メッセージ表示 |
| モーダル | モーダルダイアログ | ポップアップ形式 |

---

## 画面一覧

### 画面一覧表

| 画面ID | 画面名 | 画面種別 | URL | 権限 | 関連機能ID | 備考 |
|--------|--------|----------|-----|------|------------|------|
| {SCR-XXX} | {画面名} | {画面種別} | {URL} | {権限ロール} | {機能ID} | {備考} |
| SCR-001 | ログイン画面 | 入力 | /login | 全員 | F-01-01-01 | |
| SCR-002 | パスワードリセット画面 | 入力 | /password-reset | 全員 | F-01-01-03 | |
| SCR-010 | ユーザー登録画面 | 登録 | /register | 全員 | F-01-02-01 | |
| SCR-011 | メール認証画面 | 確認 | /verify-email | 全員 | F-01-02-02 | |
| SCR-020 | ダッシュボード | 一覧 | /dashboard | ログインユーザー | F-03-00-01 | ホーム画面 |
| SCR-100 | 商品一覧画面 | 一覧 | /products | ログインユーザー | F-02-01-01 | |
| SCR-101 | 商品詳細画面 | 詳細 | /products/:id | ログインユーザー | F-02-01-02 | |
| SCR-102 | 商品登録画面 | 登録 | /products/new | 管理者 | F-02-01-03 | |
| SCR-103 | 商品編集画面 | 編集 | /products/:id/edit | 管理者 | F-02-01-04 | |
| SCR-200 | 注文一覧画面 | 一覧 | /orders | ログインユーザー | F-03-01-01 | |
| SCR-201 | 注文詳細画面 | 詳細 | /orders/:id | ログインユーザー | F-03-01-02 | |
| SCR-202 | 注文登録画面 | 登録 | /orders/new | ログインユーザー | F-03-01-03 | |
| SCR-203 | 注文確認画面 | 確認 | /orders/confirm | ログインユーザー | F-03-01-04 | |
| SCR-204 | 注文完了画面 | 完了 | /orders/complete | ログインユーザー | F-03-01-05 | |
| SCR-300 | マイページ | 詳細 | /mypage | ログインユーザー | F-01-03-01 | |
| SCR-301 | プロフィール編集画面 | 編集 | /mypage/edit | ログインユーザー | F-01-03-02 | |
| SCR-900 | エラー画面（404） | エラー | /404 | 全員 | - | |
| SCR-901 | エラー画面（500） | エラー | /500 | 全員 | - | |

---

## 全体画面遷移図

### システム全体の画面遷移

```mermaid
graph TB
    START[アプリケーション起動]

    %% 認証フロー
    LOGIN[SCR-001<br/>ログイン画面]
    REGISTER[SCR-010<br/>ユーザー登録画面]
    VERIFY[SCR-011<br/>メール認証画面]
    RESET[SCR-002<br/>パスワードリセット画面]

    %% メインフロー
    DASHBOARD[SCR-020<br/>ダッシュボード]

    %% 商品管理フロー
    PRODUCT_LIST[SCR-100<br/>商品一覧画面]
    PRODUCT_DETAIL[SCR-101<br/>商品詳細画面]
    PRODUCT_NEW[SCR-102<br/>商品登録画面]
    PRODUCT_EDIT[SCR-103<br/>商品編集画面]

    %% 注文フロー
    ORDER_LIST[SCR-200<br/>注文一覧画面]
    ORDER_DETAIL[SCR-201<br/>注文詳細画面]
    ORDER_NEW[SCR-202<br/>注文登録画面]
    ORDER_CONFIRM[SCR-203<br/>注文確認画面]
    ORDER_COMPLETE[SCR-204<br/>注文完了画面]

    %% マイページフロー
    MYPAGE[SCR-300<br/>マイページ]
    MYPAGE_EDIT[SCR-301<br/>プロフィール編集画面]

    %% エラー画面
    ERROR404[SCR-900<br/>404エラー]
    ERROR500[SCR-901<br/>500エラー]

    %% 遷移定義
    START -->|未ログイン| LOGIN
    START -->|ログイン済み| DASHBOARD

    LOGIN -->|ログイン成功| DASHBOARD
    LOGIN -->|新規登録| REGISTER
    LOGIN -->|パスワード忘れ| RESET

    REGISTER -->|登録完了| VERIFY
    VERIFY -->|認証完了| LOGIN

    DASHBOARD -->|商品管理| PRODUCT_LIST
    DASHBOARD -->|注文管理| ORDER_LIST
    DASHBOARD -->|マイページ| MYPAGE

    PRODUCT_LIST -->|詳細表示| PRODUCT_DETAIL
    PRODUCT_LIST -->|新規登録| PRODUCT_NEW
    PRODUCT_DETAIL -->|編集| PRODUCT_EDIT
    PRODUCT_NEW -->|登録完了| PRODUCT_LIST
    PRODUCT_EDIT -->|更新完了| PRODUCT_DETAIL

    ORDER_LIST -->|詳細表示| ORDER_DETAIL
    ORDER_LIST -->|新規注文| ORDER_NEW
    ORDER_NEW -->|確認| ORDER_CONFIRM
    ORDER_CONFIRM -->|注文確定| ORDER_COMPLETE
    ORDER_COMPLETE -->|一覧へ戻る| ORDER_LIST

    MYPAGE -->|編集| MYPAGE_EDIT
    MYPAGE_EDIT -->|更新完了| MYPAGE

    %% エラー遷移
    PRODUCT_LIST -.存在しないページ.- ERROR404
    ORDER_LIST -.システムエラー.- ERROR500
```

---

## 機能別画面遷移図

### ユーザー認証フロー

```mermaid
graph TB
    START[アプリケーション起動]
    LOGIN[SCR-001: ログイン画面]
    REGISTER[SCR-010: ユーザー登録画面]
    VERIFY[SCR-011: メール認証画面]
    RESET_REQUEST[SCR-002: パスワードリセット<br/>メール送信画面]
    RESET_INPUT[SCR-003: 新パスワード<br/>入力画面]
    DASHBOARD[SCR-020: ダッシュボード]

    START -->|未ログイン| LOGIN
    LOGIN -->|ログイン成功| DASHBOARD
    LOGIN -->|"「新規登録」リンク"| REGISTER
    LOGIN -->|"「パスワードを忘れた」リンク"| RESET_REQUEST

    REGISTER -->|登録ボタン押下| VERIFY
    VERIFY -->|認証完了| LOGIN

    RESET_REQUEST -->|メール送信完了| LOGIN
    RESET_REQUEST -.リセットメール受信.- RESET_INPUT
    RESET_INPUT -->|パスワード更新完了| LOGIN

    DASHBOARD -->|ログアウト| LOGIN
```

### 商品管理フロー

```mermaid
graph TB
    DASHBOARD[SCR-020: ダッシュボード]
    LIST[SCR-100: 商品一覧画面]
    DETAIL[SCR-101: 商品詳細画面]
    NEW[SCR-102: 商品登録画面]
    EDIT[SCR-103: 商品編集画面]
    CONFIRM_DELETE[モーダル: 削除確認]

    DASHBOARD -->|"「商品管理」メニュー"| LIST
    LIST -->|商品クリック| DETAIL
    LIST -->|"「新規登録」ボタン"| NEW
    LIST -->|検索/ソート/ページング| LIST

    DETAIL -->|"「編集」ボタン"| EDIT
    DETAIL -->|"「削除」ボタン"| CONFIRM_DELETE
    DETAIL -->|"「戻る」ボタン"| LIST

    NEW -->|"「登録」ボタン"| LIST
    NEW -->|"「キャンセル」ボタン"| LIST
    NEW -->|バリデーションエラー| NEW

    EDIT -->|"「更新」ボタン"| DETAIL
    EDIT -->|"「キャンセル」ボタン"| DETAIL
    EDIT -->|バリデーションエラー| EDIT

    CONFIRM_DELETE -->|"「削除」ボタン"| LIST
    CONFIRM_DELETE -->|"「キャンセル」ボタン"| DETAIL
```

### 注文処理フロー

```mermaid
graph TB
    DASHBOARD[SCR-020: ダッシュボード]
    PRODUCT_LIST[SCR-100: 商品一覧画面]
    CART[SCR-210: カート画面]
    ORDER_NEW[SCR-202: 注文登録画面<br/>配送先・支払方法入力]
    ORDER_CONFIRM[SCR-203: 注文確認画面]
    PAYMENT[外部: 決済画面]
    ORDER_COMPLETE[SCR-204: 注文完了画面]
    ORDER_LIST[SCR-200: 注文一覧画面]
    ORDER_DETAIL[SCR-201: 注文詳細画面]

    DASHBOARD -->|"「商品一覧」メニュー"| PRODUCT_LIST
    PRODUCT_LIST -->|"「カートに追加」ボタン"| CART
    CART -->|"「注文に進む」ボタン"| ORDER_NEW
    CART -->|"「買い物を続ける」ボタン"| PRODUCT_LIST

    ORDER_NEW -->|"「確認画面へ」ボタン"| ORDER_CONFIRM
    ORDER_NEW -->|"「戻る」ボタン"| CART
    ORDER_NEW -->|バリデーションエラー| ORDER_NEW

    ORDER_CONFIRM -->|"「注文確定」ボタン"| PAYMENT
    ORDER_CONFIRM -->|"「修正」ボタン"| ORDER_NEW

    PAYMENT -->|決済成功| ORDER_COMPLETE
    PAYMENT -->|決済失敗| ORDER_NEW

    ORDER_COMPLETE -->|"「注文一覧へ」ボタン"| ORDER_LIST
    ORDER_COMPLETE -->|"「トップへ」ボタン"| DASHBOARD

    DASHBOARD -->|"「注文履歴」メニュー"| ORDER_LIST
    ORDER_LIST -->|注文クリック| ORDER_DETAIL
    ORDER_DETAIL -->|"「戻る」ボタン"| ORDER_LIST
```

### マイページフロー

```mermaid
graph TB
    DASHBOARD[SCR-020: ダッシュボード]
    MYPAGE[SCR-300: マイページ]
    PROFILE_EDIT[SCR-301: プロフィール編集画面]
    PASSWORD_CHANGE[SCR-302: パスワード変更画面]
    EMAIL_CHANGE[SCR-303: メールアドレス変更画面]
    VERIFY[SCR-011: メール認証画面]

    DASHBOARD -->|"「マイページ」メニュー"| MYPAGE
    MYPAGE -->|"「プロフィール編集」ボタン"| PROFILE_EDIT
    MYPAGE -->|"「パスワード変更」ボタン"| PASSWORD_CHANGE
    MYPAGE -->|"「メールアドレス変更」ボタン"| EMAIL_CHANGE

    PROFILE_EDIT -->|"「更新」ボタン"| MYPAGE
    PROFILE_EDIT -->|"「キャンセル」ボタン"| MYPAGE

    PASSWORD_CHANGE -->|"「更新」ボタン"| MYPAGE
    PASSWORD_CHANGE -->|"「キャンセル」ボタン"| MYPAGE

    EMAIL_CHANGE -->|"「更新」ボタン"| VERIFY
    EMAIL_CHANGE -->|"「キャンセル」ボタン"| MYPAGE
    VERIFY -->|認証完了| MYPAGE
```

---

## 画面遷移仕様

### 画面遷移パターン

| パターンID | パターン名 | 説明 | 実装方式 |
|------------|------------|------|----------|
| TP-01 | 通常遷移 | ボタン/リンククリックによる遷移 | リンク遷移 / SPA遷移 |
| TP-02 | フォーム送信遷移 | フォーム送信後の遷移 | POST → リダイレクト |
| TP-03 | モーダル表示 | モーダルダイアログ表示 | オーバーレイ表示 |
| TP-04 | タブ切り替え | 同一画面内のタブ切り替え | JavaScript制御 |
| TP-05 | エラー遷移 | エラー発生時の遷移 | エラーページ表示 |
| TP-06 | 認証エラー遷移 | 未ログイン時の遷移 | ログイン画面へリダイレクト |
| TP-07 | 外部遷移 | 外部サイトへの遷移 | 別タブで開く |

### 画面遷移詳細

#### SCR-001 ログイン画面

| 遷移元操作 | 遷移先画面 | 遷移条件 | 遷移方式 | パラメータ | 備考 |
|------------|------------|----------|----------|------------|------|
| ログインボタン押下 | SCR-020 ダッシュボード | 認証成功 | POST → リダイレクト | - | トークンをセッションに保存 |
| ログインボタン押下 | SCR-001 ログイン画面 | 認証失敗 | 同一画面 | - | エラーメッセージ表示 |
| 新規登録リンク | SCR-010 ユーザー登録画面 | - | リンク遷移 | - | |
| パスワードを忘れたリンク | SCR-002 パスワードリセット画面 | - | リンク遷移 | - | |

#### SCR-100 商品一覧画面

| 遷移元操作 | 遷移先画面 | 遷移条件 | 遷移方式 | パラメータ | 備考 |
|------------|------------|----------|----------|------------|------|
| 商品行クリック | SCR-101 商品詳細画面 | - | リンク遷移 | product_id | |
| 新規登録ボタン | SCR-102 商品登録画面 | 管理者権限あり | リンク遷移 | - | 権限チェック |
| 新規登録ボタン | SCR-900 エラー画面 | 管理者権限なし | エラー遷移 | - | 403 Forbidden |
| 検索ボタン | SCR-100 商品一覧画面 | - | GET → 同一画面 | search_query, page | クエリパラメータで検索条件保持 |
| ページネーション | SCR-100 商品一覧画面 | - | リンク遷移 | page | |
| ソートヘッダークリック | SCR-100 商品一覧画面 | - | リンク遷移 | sort_by, order | |

#### SCR-202 注文登録画面

| 遷移元操作 | 遷移先画面 | 遷移条件 | 遷移方式 | パラメータ | 備考 |
|------------|------------|----------|----------|------------|------|
| 確認画面へボタン | SCR-203 注文確認画面 | 入力値妥当 | POST → リダイレクト | 注文データ | セッションに一時保存 |
| 確認画面へボタン | SCR-202 注文登録画面 | バリデーションエラー | 同一画面 | - | エラーメッセージ表示 |
| 戻るボタン | SCR-210 カート画面 | - | リンク遷移 | - | 入力内容破棄確認 |

#### SCR-203 注文確認画面

| 遷移元操作 | 遷移先画面 | 遷移条件 | 遷移方式 | パラメータ | 備考 |
|------------|------------|----------|----------|------------|------|
| 注文確定ボタン | 外部決済画面 | - | POST → 外部遷移 | 決済情報 | 決済代行サービス |
| 修正ボタン | SCR-202 注文登録画面 | - | リンク遷移 | - | セッションから入力内容復元 |

### 認証・権限制御

| 画面ID | 認証要否 | 必要権限 | 未認証時の動作 | 権限不足時の動作 |
|--------|----------|----------|----------------|------------------|
| SCR-001 | 不要 | なし | - | - |
| SCR-010 | 不要 | なし | - | - |
| SCR-020 | 必要 | ログインユーザー | ログイン画面へリダイレクト | - |
| SCR-100 | 必要 | ログインユーザー | ログイン画面へリダイレクト | - |
| SCR-102 | 必要 | 管理者 | ログイン画面へリダイレクト | 403エラー画面表示 |
| SCR-103 | 必要 | 管理者 | ログイン画面へリダイレクト | 403エラー画面表示 |

### ブラウザバック時の動作

| 画面ID | ブラウザバック時の動作 | 理由 |
|--------|------------------------|------|
| SCR-001 | 通常の戻る動作 | |
| SCR-202 | 入力内容を保持 | ユーザビリティ向上 |
| SCR-203 | 注文登録画面へ戻る | 確認画面は履歴に残さない |
| SCR-204 | ブラウザバック無効化 | 二重送信防止 |

---

## 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 作成者 | {作成者名} | {YYYY/MM/DD} | |
| レビュー担当者 | {レビュー担当者名} | {YYYY/MM/DD} | |
| 承認者 | {承認者名} | {YYYY/MM/DD} | |

---

## 参照

### 関連ドキュメント

- [機能設計書] BD002_機能設計書
- [画面レイアウト] BD003-02_画面レイアウト
- [画面項目定義書] BD003-03_画面項目定義書

### 外部参照

- {参照先タイトル}: {URL}
