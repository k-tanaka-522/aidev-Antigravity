# 切り戻し手順書

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメントID | RL004-{YYYYMMDD} |
| プロジェクト名 | {プロジェクト名} |
| 作成日 | {YYYY/MM/DD} |
| 作成者 | {作成者名} |
| 版数 | {1.0} |

## 変更履歴

| 版数 | 日付 | 変更者 | 変更内容 |
|------|------|--------|----------|
| 1.0 | {YYYY/MM/DD} | {変更者名} | 新規作成 |

---

## 切り戻し判断基準

### 切り戻し実施条件

| No | 条件 | 判断者 |
|----|------|--------|
| 1 | {致命的なバグが発生} | {リリース責任者} |
| 2 | {システムが起動しない} | {リリース責任者} |
| 3 | {データ整合性エラー} | {リリース責任者} |
| 4 | {性能劣化(レスポンス3倍以上)} | {リリース責任者} |

### 切り戻し判断タイミング

- {リリース後30分以内に判断}
- {重大障害発生時は即座に判断}

---

## 切り戻し手順

### システム切り戻し

| No | 作業項目 | 作業内容 | コマンド | 所要時間 | 担当者 | 完了 |
|----|----------|----------|----------|----------|--------|------|
| 1 | システム停止 | サービス停止 | `systemctl stop app` | 1分 | {氏名} | {□} |
| 2 | 旧バージョンデプロイ | ロールバック実行 | `kubectl rollout undo deployment/app` | 3分 | {氏名} | {□} |
| 3 | システム再開 | サービス起動 | `systemctl start app` | 1分 | {氏名} | {□} |
| 4 | 動作確認 | ヘルスチェック | `curl /health` | 2分 | {氏名} | {□} |

### データベース切り戻し

| No | 作業項目 | 作業内容 | コマンド | 所要時間 | 担当者 | 完了 |
|----|----------|----------|----------|----------|--------|------|
| 1 | DB停止 | サービス停止 | `systemctl stop postgresql` | 1分 | {氏名} | {□} |
| 2 | バックアップから復元 | リストア実行 | `psql < backup.sql` | 15分 | {氏名} | {□} |
| 3 | DB再開 | サービス起動 | `systemctl start postgresql` | 1分 | {氏名} | {□} |
| 4 | 整合性確認 | データチェック | `SELECT COUNT(*) FROM users;` | 2分 | {氏名} | {□} |

---

## 切り戻し後の対応

### 事後確認

- [ ] システムが正常動作している
- [ ] データに異常がない
- [ ] ユーザーに通知済み
- [ ] 原因調査開始

---

## 承認記録

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| {作成者} | {氏名} | {YYYY/MM/DD} | {署名} |
