# 詳細設計書 (Detailed Design Document)

**作成者**: Coder Agent
**レビュー**: Architect Agent
**バージョン**: 0.9 (Draft)

## 1. 実装クラス・コンポーネント詳細

### 1-1. クラス図 / コンポーネント構成
（ここにMermaid記法などでクラス図やコンポーネント構成図を記述）

### 1-2. メソッド/関数定義
| クラス名 | メソッド名 | 引数 | 戻り値 | 処理概要 | 例外処理 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| UserService | `getUserById` | `id: string` | `User` | IDでユーザーを検索する。キャッシュにあればキャッシュから返す。 | `UserNotFoundException` |

### 1-3. 内部状態管理 (State Management)
（React ContextやFlux等の状態管理ロジック、あるいはサーバーサイドのセッション管理詳細）

---

## 2. データベース物理設計

### 2-1. テーブル定義 (Physical Schema)
| テーブル名 | カラム名 | 物理型 | 制約 (PK/FK/UQ/NN) | デフォルト値 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `users` | `check_terms` | `BOOLEAN` | `NOT NULL` | `false` | 利用規約同意フラグ |

### 2-2. インデックス定義
| インデックス名 | 対象テーブル | カラム構成 | 種類 (B-Tree等) |
| :--- | :--- | :--- | :--- |
| `idx_users_email` | `users` | `email` | Unique |

---

## 3. インターフェース実装詳細

### 3-1. API実装仕様
*   **Endpoint**: `POST /api/v1/users`
*   **Request Validation**:
    *   `email`: 必須, メールアドレス形式, 最大255文字
    *   `password`: 必須, 8文字以上, 英数混在
*   **Response**:
    *   201 Created: `{ "id": "...", "created_at": "..." }`
    *   400 Bad Request: `{ "code": "INVALID_PARAM", "message": "..." }`

### 3-2. 画面項目定義 (UI Specs)
| 画面ID | 項目名 | 入力タイプ | 必須 | バリデーションルール | エラーメッセージID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| SCR-001 | メールアドレス | Text | 〇 | Email形式 | MSG-E-001 |

---

## 4. 処理ロジック詳細 (Algorithm)
### 4-1. 複雑なビジネスロジック (IPO)
**処理名**: 料金計算処理
*   **Input**: 購入アイテムリスト, クーポンコード, 会員ランク
*   **Process**:
    1. 小計を算出
    2. 会員ランクによる割引率を適用 (Switch文)
    3. クーポン有効性をチェック (APIコール)
    4. 消費税端数処理 (切り捨て)
*   **Output**: 請求金額オブジェクト

---
