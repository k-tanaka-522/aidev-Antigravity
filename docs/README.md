# Antigravity - AIエージェントによるシステム開発プロセスオーケストレーション

## 🎯 プロジェクトの目的

**Antigravityは、システム開発プロセス（SDLC）をAIエージェントで自動オーケストレーションするシステムです。**

従来の「質問に答えるAI」ではなく、**開発プロセス全体をガイドし、適切なタイミングで適切な成果物を生成するAIファシリテーター**として動作します。

---

## 🏗️ システムアーキテクチャ

### オーケストレーションの3要素

Antigravityは、以下の3要素が連携して動作します：

```
┌─────────────────────────────────────────────────────────────┐
│                     AIオーケストレーター                        │
│                       (GEMINI.md)                            │
│  - フェーズ認識（企画→要件定義→基本設計→詳細設計→...）            │
│  - 提案型実行（ワークフロー提案 → ユーザー承認 → 実行）           │
│  - 一問一答形式（質問の羅列を避ける）                            │
└─────────────────────────────────────────────────────────────┘
           │                │                │
           ▼                ▼                ▼
    ┌──────────┐    ┌──────────┐    ┌──────────┐
    │ Workflow │    │ Template │    │Knowledge │
    │  ワークフロー │    │ テンプレート │    │ナレッジ   │
    └──────────┘    └──────────┘    └──────────┘
         │                │                │
         │                │                │
         ▼                ▼                ▼
    ┌──────────────────────────────────────────┐
    │           Agent (エージェント)              │
    │  - requirements-analyst                 │
    │  - system-architect                     │
    │  - detailed-designer-app                │
    │  - detailed-designer-infra              │
    │  - design-reviewer                      │
    │  - documentation-assistant              │
    └──────────────────────────────────────────┘
```

### 1️⃣ ワークフロー (Workflow)

**役割**: 各フェーズの作業手順を定義

```
.agent/workflows/
├── 01-planning.md              # 企画フェーズ
├── 02-requirements.md          # 要件定義フェーズ
├── 03-basic-design.md          # 基本設計フェーズ ⭐
├── 04-detailed-design-app.md   # 詳細設計（アプリ）
├── 05-detailed-design-infra.md # 詳細設計（インフラ）
└── ...
```

**内容例**（03-basic-design.md）:
- 入力確認（前フェーズの成果物）
- チーム分離の確認（アプリ/インフラ）
- 生成する成果物リスト
- 完了条件
- 次フェーズの提案

### 2️⃣ テンプレート (Template)

**役割**: IPA Common Frame 2013準拠の成果物テンプレート

```
.agent/templates/
├── 01_要件定義/
│   ├── RD001_システム化要求定義書_template.md
│   ├── RD002_業務要件定義書_template.md
│   └── ...（7ドキュメント）
│
├── 02_基本設計/
│   ├── BD001_システム方式設計書_template.md
│   ├── BD009_IaC設計書_template.md
│   └── ...（9ドキュメント）
│
└── 04_詳細設計/
    ├── DD001-01_クラス設計書_template.md
    ├── DD-INF001_Terraformスタック設計書_template.md
    └── ...（7ドキュメント）
```

### 3️⃣ ナレッジベース (Knowledge)

**役割**: ベストプラクティス、設計パターン、ガイドライン

```
.agent/knowledge/
├── documentation/              # IPA標準、スケーリング
│   ├── ipa-detailed-design-scaling.md
│   └── team-separation-app-infra.md
│
├── workflows/                  # 質問ガイダンス
│   └── questioning-guidance.md
│
├── architecture/               # アーキテクチャパターン
│   ├── microservices-design.md
│   └── event-driven-architecture.md
│
├── iac/                        # IaCベストプラクティス
│   ├── terraform-best-practices.md
│   └── cloudformation-patterns.md
│
└── ...（11カテゴリ）
```

---

## 🔄 オーケストレーションの動作フロー

### フェーズ認識 → ワークフロー提案 → 実行 → 成果物生成

```
ユーザー: 「ECサイトの要件定義をしたい」
          │
          ▼
    ┌─────────────────┐
    │ フェーズ認識      │  キーワード「要件定義」→ 要件定義フェーズと判定
    └─────────────────┘
          │
          ▼
    ┌─────────────────┐
    │ ワークフロー提案  │  「→ /requirements を実行しますか？」
    └─────────────────┘
          │
          ▼ ユーザー承認
    ┌─────────────────┐
    │ ワークフロー実行  │  02-requirements.md に従って実行
    └─────────────────┘
          │
          ▼
    ┌─────────────────┐
    │ 一問一答ヒアリング │  questioning-guidance.md に従い、
    │                  │  1つずつ質問（質問リスト禁止）
    └─────────────────┘
          │
          ▼
    ┌─────────────────┐
    │ テンプレート適用  │  RD001-RD007 テンプレートを使用
    └─────────────────┘
          │
          ▼
    ┌─────────────────┐
    │ ナレッジ参照      │  questioning-guidance.md を参照し、
    │                  │  適切な質問数に絞る（5-10個）
    └─────────────────┘
          │
          ▼
    ┌─────────────────┐
    │ 成果物生成        │  templates/01_要件定義/実成果物/
    │                  │  ├── RD001_システム化要求定義書.md
    │                  │  ├── RD002_業務要件定義書.md
    │                  │  └── ...
    └─────────────────┘
```

---

## 🤖 GEMINI.md - AIオーケストレーターの原則

**GEMINI.md**は、AIエージェントの動作原則を定義します。

### 1. 提案型オーケストレーション

```
❌ 勝手に実行: 「要件定義書を作成しました」
✅ 提案と確認: 「📍 現在位置：【要件定義フェーズ】
                → /requirements を実行しますか？」
```

### 2. 一問一答形式

```
✅ 良い例:
AI: 「どのような課題を解決したいですか？」
ユーザー: 「在庫管理が手作業で大変です」
AI: 「対象となる商品の種類はどのくらいありますか？」

❌ 避けるべき例（質問の羅列）:
AI: 「以下について教えてください。
1. どのような課題がありますか？
2. 対象商品の種類は？
3. 在庫確認の頻度は？
...」
```

### 3. フェーズ認識

会話のキーワードから現在のフェーズを推定：

| フェーズ | トリガーワード | 提案するワークフロー |
|---------|--------------|----------------------|
| 要件定義 | 機能、要件、ユースケース | `/requirements` |
| 基本設計 | アーキテクチャ、構成、インフラ | `/basic-design` |
| 詳細設計 | クラス、API、DB設計 | `/detailed-design` |

### 4. 成果物駆動

各フェーズで必ずIPA準拠の成果物を生成：
- 要件定義: RD001-RD007
- 基本設計: BD001-BD009
- 詳細設計: DD001-DD004, DD-INF001/002

---

## 📋 エージェントとワークフロー・テンプレート・ナレッジの関係

各エージェントは、**特定のワークフローを実行**し、**テンプレートを使って成果物を生成**し、**ナレッジベースを参照**します。

完全な関係マトリクスは [agent-workflow-matrix.md](agent-workflow-matrix.md) を参照してください。

### 例: system-architect（システムアーキテクト）

```json
{
  "workflow": "workflows/03-basic-design.md",
  "templates": [
    "templates/02_基本設計/BD001_システム方式設計書_template.md",
    "templates/02_基本設計/BD009_IaC設計書_template.md",
    ...
  ],
  "knowledge_base": [
    "knowledge/documentation/ipa-detailed-design-scaling.md",
    "knowledge/documentation/team-separation-app-infra.md",
    "knowledge/architecture/",
    "knowledge/iac/"
  ]
}
```

**動作**:
1. ワークフロー（03-basic-design.md）に従い、チーム分離の確認を行う
2. テンプレート（BD001-BD009）を使って基本設計書を生成
3. ナレッジベース（architecture/, iac/）を参照し、適切な技術選定を行う

---

## 🎓 主要な設計判断

### チーム分離対応

**課題**: 大規模プロジェクトでは、アプリチームとインフラチームが分かれる

**解決策**: ワークフロー（03-basic-design.md）で分離を確認し、成果物を分割

```
templates/02_基本設計/実成果物/
├── 00_アプリアーキテクチャ/    # アプリチーム担当
│   ├── BD001_システム方式設計書.md
│   └── BD002_アプリケーション方式設計書.md
│
└── 01_インフラアーキテクチャ/  # インフラチーム担当
    ├── BD004_ネットワーク構成設計書.md
    └── BD009_IaC設計書.md
```

### 大規模システム対応

**課題**: 100クラス超のシステムでは、1つのDD001に収まらない

**解決策**: ナレッジベース（ipa-detailed-design-scaling.md）に従い、モジュール単位で分割

```
templates/04_詳細設計/実成果物/01_アプリ/
├── ユーザー管理/
│   ├── DD001-01_クラス設計書_認証モジュール.md
│   └── DD001-02_クラス設計書_権限管理モジュール.md
│
└── 注文管理/
    └── DD001-01_クラス設計書_注文処理モジュール.md
```

### IaC設計書の軽量化

**課題**: 従来のIaC設計書はパラメーター一覧になりがち（100ページ超）

**解決策**: テンプレート（DD-INF001/002）で設計判断（Why）のみ記載

```markdown
## 設計判断
**採用構成**: マルチAZ（3AZ）

**判断理由**:
- 可用性要件 99.9% を満たすため
- 単一AZ障害時も2AZで稼働継続

**コスト**: 月額$168（NAT Gateway × 3）
```

---

## 📊 統計

| カテゴリ | 数 |
|---------|-----|
| エージェント | 6種類 |
| ワークフロー | 8フェーズ |
| 要件定義テンプレート | 7ドキュメント |
| 基本設計テンプレート | 9ドキュメント |
| 詳細設計テンプレート | 7ドキュメント |
| ナレッジカテゴリ | 11カテゴリ |
| **合計ファイル数** | **47ファイル** |

---

## 🔗 関連ドキュメント

- [architecture.md](architecture.md) - システムアーキテクチャ詳細
- [agent-workflow-matrix.md](agent-workflow-matrix.md) - エージェント/ワークフロー/テンプレート/ナレッジの完全マトリクス
- [../.agent/README.md](../.agent/README.md) - .agentディレクトリの詳細説明
- [../GEMINI.md](../GEMINI.md) - AIオーケストレーターの動作原則

---

## 🚀 使い方

詳細は [../README.md](../README.md) を参照してください。

### クイックスタート

```bash
# 1. 要件定義（ワークフロー: 02-requirements.md）
claude-agent run requirements-analyst
# → RD001-RD007を生成

# 2. 基本設計（ワークフロー: 03-basic-design.md）
claude-agent run system-architect
# → チーム分離を確認し、BD001-BD009を生成

# 3. 詳細設計（ワークフロー: 04-detailed-design-app.md）
claude-agent run detailed-designer-app
# → DD001-DD004を生成

# 4. 詳細設計（ワークフロー: 05-detailed-design-infra.md）
claude-agent run detailed-designer-infra
# → DD-INF001/002を生成
```

---

## 🎯 まとめ

Antigravityは、**ワークフロー・テンプレート・ナレッジベースの3要素が連携**することで、システム開発プロセス全体をAIがオーケストレーションするシステムです。

```
ワークフロー（手順） × テンプレート（成果物） × ナレッジ（品質）
= IPA準拠の高品質なシステム設計書
```

GEMINI.mdの原則に従い、**提案型・一問一答・フェーズ認識・成果物駆動**でユーザーを支援します。
