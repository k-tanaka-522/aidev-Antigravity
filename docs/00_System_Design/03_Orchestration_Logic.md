# 03. エージェント連携ロジック

## 1. 処理フロー概要

Antigravityエージェントは、以下の流れに従い、利用者からの指示を具体的な成果物へと変換する。

```
ワークフロー参照 → 担当エージェント特定 → 基準・テンプレート適用 → 成果物生成
```

## 2. 処理ステップ詳細

### ステップ1：作業開始指示

1. 利用者がPMエージェントに対し、作業開始を指示する。  
   （例：「フェーズ1を開始してください」）
2. PMエージェントは `workflows/full_dev_process_ja.md` を参照し、現在のフェーズと次に実行すべきタスクを特定する。

### ステップ2：担当エージェントへの切替

1. PMエージェントは、ワークフローに定義された担当エージェントを特定する。  
   （例：要件定義フェーズの場合、担当は「コンサルタント」）
2. システムは `personas/consultant.md` を読み込み、エージェントの役割をコンサルタントに切り替える。

### ステップ3：基準・テンプレートの適用

1. 担当エージェントは、ワークフローに記載された品質基準（`standards/tech/app/*` 等）およびテンプレート（`templates/02_要件定義書テンプレート.md` 等）を読み込む。
2. 以降の作業は、これらの基準・テンプレートの範囲内でのみ実施される。

### ステップ4：作業実行

1. 担当エージェントは、利用者との対話を通じてテンプレートの各項目を埋めていく。
2. 作成した内容が品質基準に違反していないかを自己検証する。

### ステップ5：次工程への引継ぎ

1. 担当エージェントは作業完了をPMエージェントに報告する。
2. PMエージェントは成果物を確認し、次のタスクへ進む。

## 3. 遵守事項

本システムの連携ロジックを正しく機能させるため、以下のルールを厳守すること。

### 3.1 ファイルパスの明示

ワークフローファイルには、参照すべきペルソナ、品質基準、テンプレートの**ファイルパスを必ず明記**すること。「適宜判断」「よしなに対応」といった曖昧な指示は禁止とする。

### 3.2 該当なし項目の明示

テンプレートの項目に該当する情報がない場合、その項目を削除せず「該当なし（N/A）」と記載し、理由を付記すること。

### 3.3 クロスレビューによるフェーズ承認

次フェーズへの移行は、単なる作業完了報告ではなく、検証エビデンス（実行ログ、操作録画等）に基づく**クロスレビューの承認**をもって行うこと。
